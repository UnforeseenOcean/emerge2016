<html>
	<head>

		<title> {{title}} </title>
		<meta charset="utf-8">

		<meta name="description" content="interactive 3d wwweb portraits.">
		<meta name="author" content="Branger_Briz">
	
		<link href="http://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic,700,700italic,800,800italic&v1" rel="stylesheet" type="text/css">
		<link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300|Lato:100|Source+Code+Pro:300,400,500,600,700' rel='stylesheet' type='text/css'>

		<link rel="stylesheet" type="text/css" href="css/styles.css">

<!-- 		CHECK LIST!!!!
		> google analytics -->

		<link rel="image_src" href="http://emerge.brangerbriz.com/N129HGSpg_4.png" />

		<meta property="og:title" content="eMerge Portraits"/>
		<meta property="og:description" content="interactive 3d wwweb portraits"/>
		<meta property="og:url" content="http://emerge.brangerbriz.com/"/>
		<meta property="og:image" content="http://emerge.brangerbriz.com/N129HGSpg_4.png"/>
		<meta property="og:site_name" content="Branger_Briz"/>
		<meta name="twitter:card" content="summary_large_image">
		<meta name="twitter:url" content="http://emerge.brangerbriz.com">
		<meta name="twitter:title" content="eMerge Portraits">
		<meta name="twitter:description" content="interactive 3d wwweb portraits">
		<meta name="twitter:image" content="http://emerge.brangerbriz.com/N129HGSpg_4.png">

		<meta name="viewport" content="width=device-width, initial-scale=1">

	</head>
	<body>

		<section id="loading">
			<div class="container"> ...loading </div>
		</section>

		<section id="splash">
			
			<a href="http://brangerbriz.com"><div class="logo"> <img src="images/Bx64.png" class="BBLogo"> Branger_Briz </div></a>

			<iframe src="" frameborder="0" class="portraitFrame"></iframe>

			<div class="ntroTxt">
				<h1> {{title}} </h1>
				<p>
					Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
					tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
					quis nostrud exercitation ullamco laboris nisi.
				</p>
				<div>
					<input type="text" placeholder="PORTRAIT ID" id="idfield">
					<a href="#" class="btnlink" id="portraitButton">view portrait</a>
				</div>
			</div>

			<svg class="arrow" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve" fill="#D98ACE"><path d="M23.092,44.335l26.586,12.69c0.012,0.006,0.025,0.004,0.037,0.01c0.051,0.021,0.102,0.027,0.152,0.037  c0.045,0.008,0.088,0.02,0.131,0.02c0.047,0,0.092-0.012,0.141-0.02c0.049-0.01,0.1-0.02,0.146-0.037  c0.012-0.006,0.025-0.004,0.039-0.01l26.584-12.69c0.374-0.18,0.532-0.626,0.354-1c-0.129-0.27-0.397-0.428-0.678-0.428  c-0.107,0-0.218,0.023-0.322,0.074L50,55.518L23.738,42.982c-0.105-0.049-0.215-0.072-0.322-0.072c-0.279,0-0.549,0.156-0.678,0.427  C22.561,43.709,22.717,44.156,23.092,44.335z"/></svg>

		</section>


		
		<section id="main" class="dark-purple">
			<div class="container">
				<!-- thumbnail selection goes here -->
			</div>		

			<div class="thumb-nav">
				<div id="tnav-left"> &lt;&lt; prev </div>
				<div id="tnav-gallery"> <a href="gallery">&lt;search gallery&gt;</a> </div>
				<div id="tnav-right"> next &gt;&gt; </div>
			</div>

		</section>
		

		<script src="flaggedList.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script> 
		<script>

			// load list from db....

			var Sessions = [];
			var thumbSpot = 0;
			var numOfThumbs = 0;
			var transTime = 100;
			var gififyLoop = null;
			var gififyCount = 0;

			$.getJSON( "http://"+window.location.host+"/api/sessions-list", function( json ) {
				if (!json.error && json.data) {

					var sesh; // load up session list && data
					for (var i = 0; i < json.data.length; i++) {
						sesh = {
							id: json.data[i].id,
							count: json.data[i].keyFrames.length,
							date: new Date(json.data[i].sessionStart)
						}
						if( flaggedList.indexOf(sesh.id) == -1 ) Sessions.push(sesh);
					};

					// set random session for splash screen
					var ranSesh = Sessions[ Math.floor(Math.random()*Sessions.length) ];
					$('.portraitFrame').attr('src',ranSesh.id+'?frame=true');

					Sessions.sort(function(a,b){ // sort from oldest to newest 
						return new Date(a.date) - new Date(b.date);
					});

					// choose 3 random sessions for thumbnails
					var ranSpot = Math.floor(Math.random()* Sessions.length-3 );
					if(ranSpot<0) ranSpot = 0;
					thumbSpot = ranSpot;
					createThumbsAt( ranSpot );
					presentThumbs();

					// give it a sec, then fadeout the load screen
					setTimeout(function(){
						$('#loading').fadeOut(1000);
					},250);
				
				} else { console.log(json); }
			});


			function gifify( thumb ){
				var id = $(thumb).attr('id');
				var obj = null
				for (var i = 0; i < Sessions.length; i++) {
					if( Sessions[i].id == id ){
						obj = Sessions[i];
						break;
					}
				};
				gififyCount++;
				if( gififyCount >= obj.count ) gififyCount = 0;
				$(thumb).attr('src',obj.id+"_"+(gififyCount+1)+".png");
			}

			function printDate( d ){
				// maybe make this more code-like ^__^ 
				// ...but still user friendly
				return d;
			}

			function createThumbsAt( spot ){
				for (var i = 0; i < 3; i++) {
					var div = document.createElement('div');
						div.className = "item";
					var img = document.createElement('img');
						img.id = Sessions[spot+i].id;
						img.src = Sessions[spot+i].id+"_"+(Math.floor(Math.random()*Sessions[spot+i].count)+1)+".png";
						img.className = "thumb thumb-start";
						img.onclick = function(){ window.location="/"+this.id }
						img.onmouseover = function(){ 
							var self = this;
							$('#'+this.id).next().css('color','#FFFFFF');
							gififyLoop = setInterval( function(){ gifify(self); }, 250 );
						}
						img.onmouseout = function(){  
							clearInterval( gififyLoop ); 
							gififyCount=0; 
							$('#'+this.id).next().css('color','#9B91A4');
						}
					var nfo = document.createElement('div');
						nfo.className = "thumbNfo thumbNfo-start";
						nfo.innerHTML = printDate( Sessions[spot+i].date );
						nfo.innerHTML += "<br>";
						nfo.innerHTML += "PORTRAIT_ID: <a href='/"+Sessions[spot+i].id+"'>" + Sessions[spot+i].id +"</a>";
					div.appendChild( img );
					div.appendChild( nfo );

					$('#main > .container').append( div );
				};
			}


			function hideThumbs(){
				var item = $('#main > .container').children();
				var img = $(item[numOfThumbs]).children()[0];
				var nfo = $(item[numOfThumbs]).children()[1];

				nfo.className = "thumbNfo thumbNfo-start";

				setTimeout(function(img){
				
					img.className = "thumb thumb-start";	
					numOfThumbs--;
					if(numOfThumbs==-1) numOfThumbs = 0;
					
					setTimeout(function(){
						if(numOfThumbs > 0) hideThumbs();
						else {
							$('#main > .container').empty();	
						} 
					},transTime/2);
				
				}, transTime/2, img );
			}

			function presentThumbs(){
				var item = $('#main > .container').children();
				var img = $(item[numOfThumbs]).children()[0];
				var nfo = $(item[numOfThumbs]).children()[1];
				
				img.className = "thumb thumb-end"; 

				setTimeout(function(nfo){

					nfo.className = "thumbNfo thumbNfo-end";
					numOfThumbs++;

					setTimeout(function(){
						if(numOfThumbs < 3) presentThumbs();
						else numOfThumbs = 2;
					},transTime/2);

				},transTime/2, nfo);
			}

			// ------------------------ transition ( hide >> create >> present )
			function transitionThumbs(){
				hideThumbs();
				setTimeout(function(){
					createThumbsAt( thumbSpot );
					presentThumbs();
				}, transTime*4 );
			}


			// click navs -----------------------------------
			function checkClickability(){
				if( thumbSpot <= 0 ){
					$('#tnav-left').css({'opacity': 0.25 , 'cursor':'default' });
					$('#tnav-right').css({'opacity': 1 , 'cursor':'pointer' });
				}
				else if( thumbSpot >= Sessions.length-3 ){
					$('#tnav-left').css({'opacity': 1 , 'cursor':'pointer' });
					$('#tnav-right').css({'opacity': 0.25 , 'cursor':'default' });					
				}
				else {
					$('#tnav-left').css({'opacity': 1 , 'cursor':'pointer' });
					$('#tnav-right').css({'opacity': 1 , 'cursor':'pointer' });
				}
			}

			$('#tnav-left').on({
				click:function(){
					checkClickability();
					if(thumbSpot <= 0) return;
					thumbSpot -= 3;
					if(thumbSpot <= 0) thumbSpot = 0; 
					checkClickability();
					transitionThumbs();
				}
			});

			$('#tnav-right').on({
				click:function(){
					checkClickability();
					if(thumbSpot >= Sessions.length-3) return;
					thumbSpot += 3;
					if(thumbSpot >= Sessions.length-3) thumbSpot = Sessions.length-3; 
					checkClickability();
					transitionThumbs();
				}
			});

			// view portrait button

			$('#portraitButton').on({
				click:function(){
					if( $('#idfield').val() == "" ) alert('forgot id');
					else {
						// maybe account for folks who might copy+paste '#:'
						window.location = $('#idfield').val();
					}
				}
			});


			// parallax 

			$(document).on({
				scroll:function(){
					var t = - ($('body').scrollTop())/3;
					var o = 1-(($('body').scrollTop()/500)/1);
					$('.portraitFrame').css({
						'top': t+"px",
						'opacity':o
					});
					$('.arrow').css('opacity',0.5-(($('body').scrollTop()/500)/1));
				}
			});


			// function resize(){
			// 	for (var i = 0; i < $('.thumb').length; i++) {
			// 		$($('.thumb')[i]).css('height', ( $($('.thumb')[i]).innerWidth() / 16) * 9 +"px");
			// 	};
				
			// } resize();


			// $(window).on({
			// 	resize: function(){
			// 		resize();
			// 	}
			// });

		</script>
		
	</body>
</html>